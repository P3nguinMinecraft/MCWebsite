{% extends "base.html" %}

{% block title %}Admin Panel — {{ config.server_name }}{% endblock %}

{% block content %}
<div class="admin-panel-section">
    <div class="container">

        <!-- Header -->
        <div class="admin-panel-header">
            <h1 class="page-title">Admin Panel</h1>
            <div class="admin-panel-actions">
                <a href="{{ url_for('change_password') }}" class="admin-btn change-password-btn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                    </svg>
                    Change Password
                </a>
                <a href="{{ url_for('admin_logout') }}" class="admin-btn logout-btn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4M16 17l5-5-5-5M21 12H9"/>
                    </svg>
                    Logout
                </a>
            </div>
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}{% for cat, msg in messages %}
            <div class="flash-message flash-{{ cat }}">{{ msg }}</div>
            {% endfor %}{% endif %}
        {% endwith %}

        <!-- Tab bar -->
        <div class="admin-tabs">
            <button class="admin-tab-btn active" data-tab="tab-details"   onclick="switchTab('tab-details')">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>
                </svg>
                Server Details
            </button>
            <button class="admin-tab-btn" data-tab="tab-mods" onclick="switchTab('tab-mods')">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
                </svg>
                Mods
            </button>
            <button class="admin-tab-btn" data-tab="tab-custom" onclick="switchTab('tab-custom')">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/>
                    <line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/>
                </svg>
                Additional Info
            </button>
            <button class="admin-tab-btn" data-tab="tab-config" onclick="switchTab('tab-config')">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"/>
                    <path d="M19.07 4.93l-1.41 1.41M4.93 19.07l1.41-1.41M19.07 19.07l-1.41-1.41M4.93 4.93l1.41 1.41M21 12h-2M5 12H3M12 3V1M12 23v-2"/>
                </svg>
                Config
            </button>
        </div>

        <!-- ── TAB 1: Server Details ──────────────────────────────────────── -->
        <div id="tab-details" class="admin-tab-pane active">
            <div class="tab-pane-header">
                <div>
                    <h2 class="tab-title">Server Details</h2>
                    <p class="tab-desc">These rows appear on the About page. Use <code class="token">{ip}</code> or <code class="token">{name}</code> to insert config values.</p>
                </div>
                <button class="save-btn-primary" onclick="saveDetails()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
                    Save Details
                </button>
            </div>

            <div id="detailRows" class="editor-rows"></div>

            <button class="add-row-btn" onclick="addDetailRow()">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
                Add Row
            </button>
        </div>

        <!-- ── TAB 2: Mods ────────────────────────────────────────────────── -->
        <div id="tab-mods" class="admin-tab-pane">
            <div class="tab-pane-header">
                <div>
                    <h2 class="tab-title">Mods</h2>
                    <p class="tab-desc">One mod per line: <code class="token">Mod Name version</code> — the last space-separated token is treated as the version.</p>
                </div>
                <button class="save-btn-primary" onclick="saveMods()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
                    Save Mods
                </button>
            </div>
            <textarea id="modsTextarea" class="mods-textarea" spellcheck="false" placeholder="ModName 1.0.0&#10;AnotherMod 2.3.1"></textarea>
        </div>

        <!-- ── TAB 3: Additional Info ─────────────────────────────────────── -->
        <div id="tab-custom" class="admin-tab-pane">
            <div class="tab-pane-header">
                <div>
                    <h2 class="tab-title">Additional Info</h2>
                    <p class="tab-desc">Create additional sections each with label/value rows.</p>
                </div>
                <button class="save-btn-primary" onclick="saveCustom()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
                    Save Info
                </button>
            </div>

            <div id="customSections" class="custom-sections-list"></div>

            <button class="add-section-btn" onclick="addSection()">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
                Add Section
            </button>
        </div>

        <!-- ── TAB 4: Config ─────────────────────────────────────────────── -->
        <div id="tab-config" class="admin-tab-pane">
            <div class="tab-pane-header">
                <div>
                    <h2 class="tab-title">Config</h2>
                    <p class="tab-desc">Core server configuration stored in <code class="token">data/config.json</code>.</p>
                </div>
                <button class="save-btn-primary" onclick="saveConfig()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
                    Save Config
                </button>
            </div>

            <div class="config-grid">
                <!-- Server Name -->
                <div class="config-field">
                    <label class="config-label">Server Name</label>
                    <input id="cfgName" type="text" class="editor-input" placeholder="My Minecraft Server">
                </div>

                <!-- IP -->
                <div class="config-field">
                    <label class="config-label">Server IP</label>
                    <input id="cfgIp" type="text" class="editor-input" placeholder="play.example.com">
                </div>

                <!-- Discord -->
                <div class="config-field config-field-full">
                    <label class="config-label">Discord Invite URL</label>
                    <input id="cfgDiscord" type="text" class="editor-input" placeholder="https://discord.gg/...">
                </div>

                <!-- File Size -->
                <div class="config-field">
                    <label class="config-label">Max Upload File Size</label>
                    <div class="file-size-row">
                        <input id="cfgFileSize" type="number" class="editor-input file-size-input" min="1" placeholder="20">
                        <select id="cfgSizeUnit" class="editor-select">
                            <option value="KB">KB</option>
                            <option value="MB" selected>MB</option>
                            <option value="GB">GB</option>
                        </select>
                    </div>
                </div>

                <!-- Allowed Extensions -->
                <div class="config-field">
                    <label class="config-label">Allowed Extensions</label>
                    <div id="extensionsList" class="ext-list"></div>
                    <button class="add-row-btn" onclick="addExtRow()" style="margin-top:0.5rem;">
                        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                        Add Extension
                    </button>
                </div>
            </div>
        </div>

    </div><!-- /container -->
</div>

<script src="{{ url_for('static', filename='scripts/admin.js') }}"></script>
{% endblock %}
